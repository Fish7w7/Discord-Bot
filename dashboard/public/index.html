<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé≠ Dashboard - Bot Discord</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Socket.io -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  
  <!-- Font Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Configura√ß√£o da fonte Inter como padr√£o */
    body {
      font-family: 'Inter', sans-serif;
    }

    /* Anima√ß√£o de "slide-in" para novas mensagens */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .message-slide-in {
      animation: slideIn 0.3s ease;
    }

    /* Anima√ß√£o de "fade-in" para feedback */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .fade-in {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-gray-100 min-h-screen p-4 md:p-8">

  <!-- Loading Overlay -->
  <div class="loading-overlay fixed inset-0 bg-gray-900/90 backdrop-blur-sm flex flex-col items-center justify-center z-50 text-white" id="loading-overlay">
    <div class="spinner w-16 h-16 border-4 border-gray-600 border-t-indigo-500 rounded-full animate-spin mb-6"></div>
    <h2 class="text-2xl font-bold mb-2">Aguardando bot conectar...</h2>
    <p class="text-lg text-gray-400">Isso pode levar alguns segundos</p>
  </div>

  <div class="container max-w-7xl mx-auto">
    
    <!-- Header -->
    <div class="header bg-gray-800/80 backdrop-blur-md border border-gray-700 rounded-2xl p-6 shadow-2xl mb-6">
      <h1 class="text-3xl font-bold text-white mb-3 flex items-center gap-3">
        <!-- Status Indicator -->
        <span class="status w-4 h-4 rounded-full" id="bot-status"></span>
        <!-- Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M10 16.5 12 3l2 13.5"/><path d="M7 11.5 17 21"/><path d="m17 11.5-10 9.5"/></svg>
        <span>Dashboard - Bot Discord</span>
      </h1>
      <p id="bot-info" class="text-gray-400">Carregando informa√ß√µes...</p>
      
      <!-- Stats Grid -->
      <div class="stats grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-5">
        <div class="stat-card bg-gray-700/50 border border-gray-600 p-4 rounded-lg">
          <h3 class="text-sm font-semibold text-indigo-400 uppercase tracking-wider">Mensagens Enviadas</h3>
          <p id="stat-messages" class="text-3xl font-bold text-white">0</p>
        </div>
        <div class="stat-card bg-gray-700/50 border border-gray-600 p-4 rounded-lg">
          <h3 class="text-sm font-semibold text-indigo-400 uppercase tracking-wider">Rea√ß√µes Adicionadas</h3>
          <p id="stat-reactions" class="text-3xl font-bold text-white">0</p>
        </div>
        <div class="stat-card bg-gray-700/50 border border-gray-600 p-4 rounded-lg">
          <h3 class="text-sm font-semibold text-indigo-400 uppercase tracking-wider">Servidor Atual</h3>
          <p id="stat-guild" class="text-xl font-bold text-white truncate">-</p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content grid grid-cols-1 lg:grid-cols-2 gap-6">
      
      <!-- Messages Feed -->
      <div class="panel bg-gray-800/80 backdrop-blur-md border border-gray-700 rounded-2xl p-6 shadow-2xl">
        <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
          Feed de Mensagens
        </h2>
        <div class="messages-container h-96 overflow-y-auto bg-gray-900/70 rounded-lg p-4 space-y-3" id="messages">
          <div class="loading-messages flex flex-col items-center justify-center h-full text-gray-500">
            <div class="spinner w-8 h-8 border-2 border-gray-600 border-t-indigo-500 rounded-full animate-spin mb-4"></div>
            <p>Aguardando mensagens...</p>
          </div>
        </div>
      </div>

      <!-- Control Panel -->
      <div class="panel bg-gray-800/80 backdrop-blur-md border border-gray-700 rounded-2xl p-6 shadow-2xl">
        <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M2.5 10.5c.1-2.2 1-4.2 2.5-5.8s3.6-2.4 5.8-2.5C12.3 2.1 14 2 15.2 2h1.6c.7 0 1.3.1 1.9.4l.4.2c.2.1.4.2.6.4s.3.4.4.6l.2.4c.3.6.4 1.2.4 1.9v1.6c0 1.2-.1 2.9-1.2 4.5s-2.9 2.7-5.8 2.5c-1.7-.1-3.3-.8-4.5-2s-1.9-2.8-2-4.5c0-.2 0-.4 0-.6v-1.6c0-.2 0-.4 0-.6Z"></path><path d="M14 8V6H8v2"></path><path d="M12 18h.01"></path><path d="M10 15h4"></path><path d="m14 12-2 2-2-2"></path></svg>
          Controle Manual
        </h2>
        <div class="control-panel flex flex-col gap-4">
          
          <!-- MENSAGENS NO CHAT -->
          <div class="form-group flex flex-col gap-2">
            <label for="channel-select" class="text-sm font-semibold text-gray-300">Canal de Texto:</label>
            <select id="channel-select" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors">
              <option value="">Carregando canais...</option>
            </select>
          </div>

          <div class="form-group flex flex-col gap-2">
            <label for="message-input" class="text-sm font-semibold text-gray-300">Mensagem:</label>
            <textarea id="message-input" placeholder="Digite a mensagem que o bot vai enviar... (Ctrl+Enter para enviar)" rows="3" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors"></textarea>
          </div>

          <button id="send-btn" onclick="sendMessage()" class="w-full p-3 bg-gradient-to-r from-indigo-600 to-indigo-700 text-white font-bold rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 transform transition-all flex items-center justify-center gap-2 disabled:bg-gray-500 disabled:from-gray-500 disabled:transform-none disabled:cursor-not-allowed">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"></path><path d="m22 2-11 11"></path></svg>
            <span>Enviar Mensagem</span>
          </button>

          <!-- Feedback area -->
          <div id="feedback" class="h-12"></div>

          <div class="quick-actions grid grid-cols-2 gap-3">
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickMessage('fala galera')">
              üëã Fala galera
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickMessage('to com fome')">
              üçï To com fome
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickMessage('bora jogar')">
              üéÆ Bora jogar
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickMessage('kkkkk')">
              üòÇ kkkkk
            </button>
          </div>

          <hr class="border-t border-gray-700 my-2">

          <!-- CONTROLES DE VOZ -->
          <h3 class="text-lg font-semibold text-white flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="23"></line></svg>
            Controles de Voz
          </h3>
          
          <div class="form-group flex flex-col gap-2">
            <label for="voice-channel-select" class="text-sm font-semibold text-gray-300">Canal de Voz:</label>
            <select id="voice-channel-select" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors">
              <option value="">Carregando canais de voz...</option>
            </select>
          </div>
          
          <div class="grid grid-cols-2 gap-3">
            <button id="join-voice-btn" onclick="joinVoiceChannel()" class="quick-btn p-3 text-sm bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white font-bold rounded-lg shadow-md transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3Z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" x2="12" y1="19" y2="23"></line></svg>
              <span>Entrar na Call</span>
            </button>
            <button id="leave-voice-btn" onclick="leaveVoiceChannel()" class="quick-btn p-3 text-sm bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-bold rounded-lg shadow-md transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" x2="9" y1="12" y2="12"></line></svg>
              <span>Sair da Call</span>
            </button>
          </div>
          
          <div id="voice-status" class="voice-status p-3 rounded-lg text-center text-sm font-medium bg-gray-700 text-gray-300 transition-colors">
            Status: N√£o conectado
          </div>

          <hr class="border-t border-gray-700 my-2">

          <!-- TTS - FALAR NA CALL -->
          <h3 class="text-lg font-semibold text-white flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            Falar na Call (TTS)
          </h3>

          <div class="form-group flex flex-col gap-2">
            <label for="tts-input" class="text-sm font-semibold text-gray-300">O que falar:</label>
            <textarea id="tts-input" placeholder="Digite o que o bot vai falar na call..." rows="3" class="w-full p-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors"></textarea>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <button id="speak-btn" onclick="speakInVoice()" class="quick-btn p-3 text-sm bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-500 hover:to-indigo-600 text-white font-bold rounded-lg shadow-md transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
              <span>Falar</span>
            </button>
            <button id="stop-speak-btn" onclick="stopSpeaking()" class="quick-btn p-3 text-sm bg-gradient-to-r from-red-600 to-red-700 hover:from-red-500 hover:to-red-600 text-white font-bold rounded-lg shadow-md transition-all flex items-center justify-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
              <span>Parar</span>
            </button>
          </div>
          
          <div class="quick-actions grid grid-cols-2 gap-3 mt-2">
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('fala galera')">
              üëã Fala galera
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('to com fome')">
              üçï To com fome
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('bora jogar')">
              üéÆ Bora jogar
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('kkkkkk')">
              üòÇ kkkkk
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('que isso mano')">
              üò± Que isso mano
            </button>
            <button class="quick-btn p-2.5 text-sm bg-gray-700/80 hover:bg-gray-700 text-white font-semibold rounded-lg shadow transition-colors" onclick="quickSpeak('concordo')">
              üëç Concordo
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Elementos DOM ---
    const loadingOverlay = document.getElementById('loading-overlay');
    const botStatus = document.getElementById('bot-status');
    const botInfo = document.getElementById('bot-info');
    const statMessages = document.getElementById('stat-messages');
    const statReactions = document.getElementById('stat-reactions');
    const statGuild = document.getElementById('stat-guild');
    const messagesContainer = document.getElementById('messages');
    const channelSelect = document.getElementById('channel-select');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const feedbackDiv = document.getElementById('feedback');
    const voiceChannelSelect = document.getElementById('voice-channel-select');
    const voiceStatusDiv = document.getElementById('voice-status');
    const ttsInput = document.getElementById('tts-input');
    
    // --- √çcones e Texto de Bot√µes ---
    const sendBtnOriginalHTML = sendBtn.innerHTML;
    const spinnerIcon = `<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

    // --- Estado da Aplica√ß√£o ---
    const socket = io('http://localhost:3001');
    let botReady = false;

    // --- Conex√£o WebSocket ---
    socket.on('connect', () => {
      console.log('‚úÖ Conectado ao WebSocket');
      checkBotReady();
    });

    socket.on('botReady', (data) => {
      console.log('üéâ Bot est√° pronto!', data);
      handleBotReady();
    });

    socket.on('newMessage', (data) => {
      addMessageToFeed(data);
    });

    // --- Fun√ß√µes de Inicializa√ß√£o ---
    async function checkBotReady() {
      if (botReady) return;
      try {
        const res = await fetch('http://localhost:3001/api/status');
        const data = await res.json();
        
        if (data.guild) {
          handleBotReady();
        } else {
          setTimeout(checkBotReady, 1000);
        }
      } catch (error) {
        console.error('Erro ao verificar status:', error);
        setTimeout(checkBotReady, 1000);
      }
    }

    function handleBotReady() {
      if (botReady) return; // Prevenir execu√ß√£o m√∫ltipla
      botReady = true;
      loadingOverlay.classList.add('hidden');
      botStatus.classList.remove('bg-red-500');
      botStatus.classList.add('bg-green-500', 'animate-pulse');
      loadAll();
    }

    function loadAll() {
      loadStatus();
      loadChannels();
      loadMessages();
      loadVoiceChannels();
    }
    
    // --- Carregamento de Dados (API) ---
    async function loadStatus() {
      try {
        const res = await fetch('http://localhost:3001/api/status');
        const data = await res.json();
        
        botInfo.textContent = `Personificando: ${data.bot.name} | ID: ${data.bot.username}`;
        statMessages.textContent = data.stats.messagesSent;
        statReactions.textContent = data.stats.reactionsAdded;
        statGuild.textContent = data.guild ? data.guild.name : 'Aguardando...';
      } catch (error) {
        console.error('Erro ao carregar status:', error);
      }
    }

    async function loadChannels() {
      if (!botReady) return;
      
      try {
        const res = await fetch('http://localhost:3001/api/channels');
        const data = await res.json();
        
        channelSelect.innerHTML = '<option value="">Selecione um canal...</option>';
        
        data.channels.forEach(channel => {
          const option = document.createElement('option');
          option.value = channel.id;
          option.textContent = `# ${channel.name}`;
          channelSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Erro ao carregar canais:', error);
      }
    }

    async function loadMessages() {
      try {
        const res = await fetch('http://localhost:3001/api/messages');
        const data = await res.json();
        
        if (data.messages && data.messages.length === 0) {
          messagesContainer.innerHTML = '<div class="loading-messages flex flex-col items-center justify-center h-full text-gray-500"><p>Nenhuma mensagem ainda...</p></div>';
          return;
        }
        
        messagesContainer.innerHTML = '';
        if (data.messages) {
          data.messages.reverse().forEach(msg => {
            addMessageToFeed({
              author: msg.author,
              content: msg.content,
              channel: msg.channelName,
              timestamp: new Date(msg.timestamp).toLocaleTimeString()
            }, false); // N√£o animar mensagens iniciais
          });
        }
      } catch (error) {
        console.error('Erro ao carregar mensagens:', error);
      }
    }

    async function loadVoiceChannels() {
      if (!botReady) return;
      
      try {
        const res = await fetch('http://localhost:3001/api/voice-channels');
        const data = await res.json();
        
        if (data.error) {
          voiceChannelSelect.innerHTML = `<option value="">${data.error}</option>`;
          return;
        }
        
        voiceChannelSelect.innerHTML = '<option value="">Selecione um canal de voz...</option>';
        
        if (data.channels.length === 0) {
          voiceChannelSelect.innerHTML = '<option value="">Nenhum canal de voz encontrado</option>';
          return;
        }
        
        data.channels.forEach(channel => {
          const option = document.createElement('option');
          option.value = channel.id;
          option.textContent = `üîä ${channel.name} (${channel.members} pessoas)`;
          voiceChannelSelect.appendChild(option);
        });
        
        loadVoiceStatus();
      } catch (error) {
        console.error('Erro ao carregar canais de voz:', error);
      }
    }

    async function loadVoiceStatus() {
      try {
        const res = await fetch('http://localhost:3001/api/voice/status');
        const data = await res.json();
        
        voiceStatusDiv.classList.remove('bg-green-600', 'text-white', 'bg-gray-700', 'text-gray-300');
        
        if (data.inVoice) {
          voiceStatusDiv.innerHTML = `üé§ Conectado em: <strong>${data.channel.name}</strong>`;
          voiceStatusDiv.classList.add('bg-green-600', 'text-white');
        } else {
          voiceStatusDiv.innerHTML = 'Status: N√£o conectado';
          voiceStatusDiv.classList.add('bg-gray-700', 'text-gray-300');
        }
      } catch (error) {
        console.error('Erro ao carregar status de voz:', error);
      }
    }

    // --- Fun√ß√µes de A√ß√£o (POST) ---
    async function sendMessage() {
      const channelId = channelSelect.value;
      const text = messageInput.value.trim();
      
      if (!channelId) {
        showFeedback('Selecione um canal!', 'error');
        return;
      }
      if (!text) {
        showFeedback('Digite uma mensagem!', 'error');
        return;
      }
      
      sendBtn.disabled = true;
      sendBtn.innerHTML = `${spinnerIcon} <span>Enviando...</span>`;
      
      try {
        const res = await fetch('http://localhost:3001/api/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ channelId, text })
        });
        
        const data = await res.json();
        
        if (data.success) {
          showFeedback(`‚úÖ Enviado: "${data.humanizedText}"`, 'success');
          messageInput.value = '';
          loadStatus();
        } else {
          showFeedback(`‚ùå Erro: ${data.error}`, 'error');
        }
      } catch (error) {
        showFeedback('‚ùå Erro de conex√£o!', 'error');
      } finally {
        sendBtn.disabled = false;
        sendBtn.innerHTML = sendBtnOriginalHTML;
      }
    }
    
    async function joinVoiceChannel() {
      const channelId = voiceChannelSelect.value;
      if (!channelId) {
        showFeedback('Selecione um canal de voz!', 'error');
        return;
      }
      
      try {
        const res = await fetch('http://localhost:3001/api/voice/join', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ channelId })
        });
        const data = await res.json();
        if (data.success) {
          showFeedback(`‚úÖ Entrou no canal: ${data.channelName}`, 'success');
          loadVoiceStatus();
          loadVoiceChannels(); // Atualiza contagem de membros
        } else {
          showFeedback(`‚ùå Erro: ${data.error}`, 'error');
        }
      } catch (error) {
        showFeedback('‚ùå Erro de conex√£o!', 'error');
      }
    }
    
    async function leaveVoiceChannel() {
      try {
        const res = await fetch('http://localhost:3001/api/voice/leave', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (data.success) {
          showFeedback('‚úÖ Saiu do canal de voz', 'success');
          loadVoiceStatus();
          loadVoiceChannels(); // Atualiza contagem de membros
        } else {
          showFeedback(`‚ùå Erro: ${data.error}`, 'error');
        }
      } catch (error) {
        showFeedback('‚ùå Erro de conex√£o!', 'error');
      }
    }

    async function speakInVoice() {
      const text = ttsInput.value.trim();
      if (!text) {
        showFeedback('Digite algo para falar!', 'error');
        return;
      }
      
      try {
        const res = await fetch('http://localhost:3001/api/voice/speak', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        if (data.success) {
          showFeedback(`üîä Falando: "${text}"`, 'success');
          ttsInput.value = '';
        } else {
          showFeedback(`‚ùå Erro: ${data.error}`, 'error');
        }
      } catch (error) {
        showFeedback('‚ùå Erro de conex√£o!', 'error');
      }
    }

    async function stopSpeaking() {
      try {
        const res = await fetch('http://localhost:3001/api/voice/stop', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const data = await res.json();
        if (data.success) {
          showFeedback('üõë Parou de falar', 'success');
        }
      } catch (error) {
        showFeedback('‚ùå Erro de conex√£o!', 'error');
      }
    }

    // --- Fun√ß√µes Utilit√°rias ---
    function addMessageToFeed(data, animate = true) {
      const loadingMsg = messagesContainer.querySelector('.loading-messages');
      if (loadingMsg) loadingMsg.remove();
      
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message bg-gray-800 p-3 rounded-lg shadow-sm border-l-4 border-indigo-500';
      if (animate) {
        msgDiv.classList.add('message-slide-in');
      }
      
      msgDiv.innerHTML = `
        <div class="message-author font-bold text-indigo-400">${data.author}</div>
        <div class="message-meta text-xs text-gray-500 mb-1">${data.channel} ‚Ä¢ ${data.timestamp}</div>
        <div class="message-content text-gray-200 break-words">${data.content}</div>
      `;
      
      messagesContainer.appendChild(msgDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function quickMessage(text) {
      messageInput.value = text;
      messageInput.focus();
    }

    function quickSpeak(text) {
      ttsInput.value = text;
      speakInVoice();
    }

    function showFeedback(message, type) {
      feedbackDiv.innerHTML = ''; // Limpa feedback anterior
      
      const feedbackEl = document.createElement('div');
      feedbackEl.className = `p-3 rounded-lg text-center font-semibold fade-in ${
        type === 'success' 
          ? 'bg-green-900/50 text-green-300' 
          : 'bg-red-900/50 text-red-300'
      }`;
      feedbackEl.textContent = message;
      
      feedbackDiv.appendChild(feedbackEl);
      
      setTimeout(() => {
        feedbackEl.remove();
      }, 3000);
    }

    // --- Event Listeners ---
    messageInput.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    // --- Polling (Intervalos) ---
    setInterval(() => {
      if (botReady) loadStatus();
    }, 5000);
    
    setInterval(() => {
      if (botReady) loadVoiceChannels();
    }, 10000);

    // --- Estado Inicial ---
    botStatus.classList.add('bg-red-500'); // Come√ßa offline

  </script>
</body>
</html>